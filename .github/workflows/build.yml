name: Build and Release

on:
  push:
    tags:
      - 'v*.*.*'

jobs:
  build:
    name: Build Release Archive
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Build Archive
        run: |
          VERSION=${GITHUB_REF_NAME#v}
          cd houdini/TumblePipe
          zip -r ../../tumblepipe-${VERSION}.zip \
            hpm.toml \
            otls \
            python \
            python3.11libs/pythonrc.py \
            python3.11libs/uiready.py \
            python3.11libs/external/requirements.txt \
            desktop \
            python_panels \
            resources \
            -x "*.pyc" \
            -x "__pycache__/*" \
            -x "python3.11libs/external/windows/*" \
            -x "python3.11libs/external/linux/*" \
            -x "python3.11libs/external/macos/*"

      - name: Upload to Release
        uses: softprops/action-gh-release@v2
        with:
          files: tumblepipe-*.zip
          fail_on_unmatched_files: false
